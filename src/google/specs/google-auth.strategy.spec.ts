import { GoogleAuthStrategy } from '../google-auth.strategy'
import { MockGoogleAuthService } from './mock.google-auth.service'

describe('GoogleAuthStrategy', () => {
  it('should validate provided credentials', async () => {
    const strategy = new GoogleAuthStrategy({
      strategyOptions: {
        clientID: 'id1234',
        clientSecret: 'Matt Murdock is Daredevil',
        callbackURL: 'http://localhost:3000/auth/google/callback',
        scope: ['email', 'profile'],
      },
      authService: new MockGoogleAuthService(),
    })

    const accessToken = 'abc'
    const refreshToken = 'xyz'
    const profile = {
      displayName: 'Matt Murdock',
      userId: '12345',
      profileUrl:
        'data:image/jpeg;base64,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',
      id: '10769150350006150715113082367',
      provider: '',
      _raw: '',
      _json: {
        iss: 'https://accounts.google.com',
        azp: '1234987819200.apps.googleusercontent.com',
        aud: '1234987819200.apps.googleusercontent.com',
        sub: '10769150350006150715113082367',
        at_hash: 'HK6E_P6Dh8Y93mRNtsDB1Q',
        hd: 'example.com',
        email: 'mmurdock@gmail.com',
        iat: 1353601026,
        exp: 1353604926,
        nonce: '0394852-3190485-2490358',
      },
    }

    const { displayName, id } = profile

    const expected = { displayName, id, superhero: true }

    await expect(
      strategy.validate(accessToken, refreshToken, profile),
    ).resolves.toEqual(expected)
  })
})
